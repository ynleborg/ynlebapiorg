<html>
<head>
    <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
    <script src="https://cdn.datatables.net/1.10.16/js/jquery.dataTables.min.js"></script>
    <link rel="stylesheet" href="https://cdn.datatables.net/1.10.16/css/jquery.dataTables.min.css"
          crossorigin="anonymous">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
<table id="leaderboard" class="display compact">
    <thead>
    <tr>
        <th>Pozycja</th>
        <th>Gracz</th>
        <th>Platforma</th>
        <th>Start (23.05)</th>
        <th>Aktualny</th>
        <th>Delta</th>
    </tr>
    </thead>
    <tbody>
    </tbody>
</table>
<script>
    $.ajax({
        //url: "http://localhost:9080/api/leaderboard" //do test√≥w
        url: "/api/leaderboard"
    }).done(function (data) {
        let i = 1;
        for (let row of data) {
            var tr = document.createElement("tr");
            tr.appendChild(addRow(i++, 'position'));
            tr.appendChild(addGamerRow(row.userName, row.icon));
            tr.appendChild(addPlatformRow(getPlatform(row.icon)));
            tr.appendChild(addRow(row.initialScore, 'score'));
            tr.appendChild(addRow(row.currentScore, 'score'));
            tr.appendChild(addRow(row.delta, 'score'));
            $("#leaderboard tbody").append(tr);
        }
        $('#leaderboard').DataTable({
            paging: false
        });
    });

    function getPlatform(icon) {
        if (icon.includes("trueachievements")) {
            return "xbox";
        } else if (icon.includes("truetrophies")) {
            return "ps4";
        } else {
            return "steam";
        }
    }

    function addGamerRow(userName, icon) {
        let td = document.createElement("td");
        let div = document.createElement('div');
        let img = document.createElement('img');
        img.setAttribute('src', icon);
        let a = document.createElement('a');
        a.classList.add("username");
        let createAText = document.createTextNode(userName);
        a.appendChild(createAText);
        a.setAttribute('href', getLink(userName, icon));
        div.appendChild(img);
        div.appendChild(a);
        td.appendChild(div);
        return td;
    }

    function getLink(userName, icon) {
        if (icon.includes("trueachievements")) {
            return "https://www.trueachievements.com/gamer/" + userName;
        } else if (icon.includes("truetrophies")) {
            return "https://www.truetrophies.com/gamer/" + userName;
        } else {
            return "https://www.truesteamachievements.com/gamer/" + userName;
        }
    }

    function addRow(value, className) {
        let td = document.createElement("td");
        let div = document.createElement('div');
        div.classList.add(className);
        let cell = document.createTextNode(value);
        div.appendChild(cell);
        td.appendChild(div);
        return td;
    }

    function addPlatformRow(platform) {
        let td = document.createElement("td");
        let div = document.createElement('div');
        div.classList.add(platform);
        let a = document.createElement('a');
        let createAText = document.createTextNode(platform);
        a.appendChild(createAText);
        a.setAttribute('href',getLeaderboard(platform));
        div.appendChild(a);
        td.appendChild(div);
        return td;
    }

    function getLeaderboard(platform) {
        if (platform.includes("xbox")) {
            return "https://www.trueachievements.com/leaderboard.aspx?leaderboardid=7810";
        } else if (platform.includes("ps4")) {
            return "https://www.truetrophies.com/leaderboard.aspx?leaderboardid=393";
        } else {
            return "https://www.truesteamachievements.com/leaderboard.aspx?leaderboardid=91";
        }
    }
</script>
</body>
</html>
